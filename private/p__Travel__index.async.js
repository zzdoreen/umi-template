"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[63],{9700:function(nt,N,t){t.d(N,{MU:function(){return q},dd:function(){return w}});var b=t(60522),$=t(64665),V=t(23435),R=t(167),H=t(63372),S=t(49956),m=t(78537),J=t(75171),Y=t(84636),G=t(50838),X=t(69514),Q=t(41151),U=t(28465),K=t(7162),k=t(35183),Z=t(53370),l=t(31648),_=t(6228),F=t(67294);k.D([$.N,V.N,R.N,H.N,S.N,m.N,J.N,Y.N,G.N,X.N,Q.N,_.N,U.N,K.N]);function w(j){var D=(0,b.Z)(j);(0,F.useEffect)(function(){var i;j.current&&((i=Z.JE(j.current))===null||i===void 0||i.resize())},[D])}function q(j,D){(0,F.useEffect)(function(){if(!j.current)return;var i=Z.S1(j.current);i.setOption(D);function c(){i==null||i.resize()}return window.addEventListener("resize",c),function(){i.dispose(),window.removeEventListener("resize",c)}},[])}N.ZP=l},43614:function(nt,N,t){t.r(N),t.d(N,{default:function(){return j}});var b=t(13769),$=t.n(b),V=t(97857),R=t.n(V),H=t(5574),S=t.n(H),m=t(67294),J=t(74627),Y=t(73318),G=t(18429),X=t(64599),Q=t.n(X),U=t(9700),K=t(83062),k=t(41730),Z=t(80854),l=t(85893),_=function(i){var c=(0,m.useMemo)(function(){return Object.keys(i).map(function(P){return{value:i[P],name:P}})},[i]),y=(0,m.useRef)(null),g={title:{left:"center",top:"center",text:`\u82B1\u8D39
`.concat(c.reduce(function(P,O){return P+(O==null?void 0:O.value)},0))},tooltip:{},legend:{left:"center",bottom:400},series:{type:"pie",radius:["35%","60%"],data:c,label:{show:!0,formatter:`{b}: {c}\u5143 

({d}%)`},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(200, 0, 0, 0.5)"}}}};return(0,U.dd)(y),(0,U.MU)(y,g),(0,l.jsx)("div",{className:"chart",ref:y})},F=function(i){var c=i.map,y=i.centerAndZoomMap,g=(0,m.useState)(!1),P=S()(g,2),O=P[0],v=P[1];return(0,l.jsxs)("div",{className:"tools",children:[(0,l.jsx)(K.Z,{placement:"left",title:"\u5207\u6362\u5730\u56FE\u7C7B\u578B",children:(0,l.jsx)("div",{className:"tool mapType",onClick:function(){var p=(c==null?void 0:c.getMapType())===BMAP_NORMAL_MAP?BMAP_HYBRID_MAP:BMAP_NORMAL_MAP;c==null||c.setMapType(p)},children:"\u7C7B\u578B"})}),(0,l.jsx)(K.Z,{placement:"left",title:"\u82B1\u8D39\u7EDF\u8BA1",children:(0,l.jsx)("div",{className:"tool statistic",onClick:function(){y(0),v(!0)},children:"\u7EDF\u8BA1"})}),(0,l.jsx)(K.Z,{placement:"left",title:"\u8FD4\u56DE\u9ED8\u8BA4\u5730\u56FE",children:(0,l.jsx)("div",{onClick:function(){return y(0)},className:"tool reset",children:"\u8FD4\u56DE"})}),(0,l.jsx)(w,{visible:O,setVisible:v})]})},w=function(i){var c=i.visible,y=i.setVisible,g=(0,Z.useModel)("@@initialState",function(u){var n=u.initialState;return n==null?void 0:n.travelData}),P=g.detailInfo,O=(0,m.useRef)(null),v=[],T=[],p=Object.values(JSON.parse(JSON.stringify(P))).reduce(function(u,n,I){var A=Object.keys(n).filter(function(e){return!["title","time"].includes(e)}),o=A.reduce(function(e,f){return e+=typeof n[f]=="number"&&f!=="\u603B\u989D"?n[f]:0},0);if(T.push([n.name,o]),I===0)u=A.map(function(e){return[e,n[e]]}),v=A;else{var r=A.filter(function(e){return!v.includes(e)});r.length&&(v=v.concat(r),r.forEach(function(e){u.push([e])}));var a=Q()(A),s;try{var E=function(){var f=s.value;u.forEach(function(h){h[0]===f&&(h[I+1]=n[f])})};for(a.s();!(s=a.n()).done;)E()}catch(e){a.e(e)}finally{a.f()}}return u},[]),z={legend:{},tooltip:{trigger:"axis",confine:!0},dataset:{source:p},xAxis:{type:"category",axisLabel:{formatter:function(n){return n.split(" ").join(`

`)}}},title:{text:p[0][1].split(" ").join(`
`)+`

`+p.reduce(function(u,n){return u+=typeof n[1]=="number"?n[1]:0},0),left:"center",top:"18%"},yAxis:{gridIndex:0},grid:{top:"55%"},series:p.map(function(u,n){return n===p.length-1?{type:"pie",id:"pie",radius:["20%","30%"],center:["50%","25%"],emphasis:{focus:"self"},label:{formatter:"{b}: {@".concat(p[0][1],"} ({d}%)")},encode:{itemName:p[0][0],value:p[0][1],tooltip:p[0][1]}}:{type:"line",smooth:!0,seriesLayoutBy:"row",label:{show:!0,position:"top"},emphasis:{focus:"series"}}}).concat({type:"bar",name:"\u603B\u82B1\u8D39",data:T,barWidth:15,barGap:"20%"}),dataZoom:[{type:"inside",zoomOnMouseWheel:!0,moveOnMouseWheel:!0,moveOnMouseMove:!0}]};return(0,m.useEffect)(function(){if(!c)return;var u=U.ZP.init(O.current);u.on("updateAxisPointer",function(I){var A=I.axesInfo[0];if(A){var o=A.value+1;u.setOption({title:{text:p[0][o].split(" ").join(`
`)+`

`+p.reduce(function(r,a){return r+=typeof a[o]=="number"?a[o]:0},0),left:"center",top:"18%"},series:{id:"pie",label:{formatter:"{b}: {@["+o+"]} ({d}%)"},encode:{value:o,tooltip:o}}})}}),u.setOption(z);function n(){u==null||u.resize()}return window.addEventListener("resize",n),function(){u.dispose(),window.removeEventListener("resize",n)}},[c]),(0,l.jsx)(k.Z,{width:800,title:"\u7EDF\u8BA1",open:c,footer:!1,onCancel:function(){return y(!1)},children:(0,l.jsx)("div",{ref:O,className:"statistic-modal"})})},q=["title","time","name"];function j(){var D=(0,Z.useModel)("@@initialState",function(o){var r=o.initialState;return r==null?void 0:r.travelData}),i=D.detailInfo,c=D.traveled,y=D.traveledPoint,g=(0,m.useRef)(null),P=(0,m.useState)(),O=S()(P,2),v=O[0],T=O[1],p=(0,m.useState)({}),z=S()(p,2),u=z[0],n=z[1],I=(0,m.useRef)(),A=(0,m.useCallback)(function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:500;setTimeout(function(){var r;(r=I.current)===null||r===void 0||r.call(I),n({})},o)},[]);return(0,m.useEffect)(function(){if(g.current){var o=new BMap.Map(g.current),r=new BMap.Point(109,36);o.centerAndZoom(r,6),o.enableScrollWheelZoom(),o.setMapType(BMAP_HYBRID_MAP),T(o);var a=function(){n({})};return["zoomend","dragend"].forEach(function(s){return o.addEventListener(s,a)}),function(){["zoomend","dragend"].forEach(function(s){return o.removeEventListener(s,a)})}}},[]),(0,m.useEffect)(function(){if(v){var o=new BMap.Boundary,r=[];fetch("./geojson/nepal-states.geojson").then(function(a){return a==null?void 0:a.json()}).then(function(a){var s=a.features;if(Array.isArray(s)&&s!==null&&s!==void 0&&s.length){var E=[];return s.forEach(function(e){var f=e.geometry,h=f===void 0?{}:f,B=h.coordinates,d=B===void 0?[]:B,L=d==null?void 0:d.map(function(M){var C=S()(M,2),W=C[0],tt=C[1];return new BMap.Point(W,tt)}),x=new BMap.Polygon(L,{strokeWeight:2,strokeStyle:"dashed",strokeColor:"#0000ff",strokeOpacity:.6,fillColor:"rgba(200,100,55,0.7)"});E=E.concat(x),r=r.concat(x.getPath()),x.addEventListener("click",function(M){var C=M==null?void 0:M.pixel,W=C.x,tt=C.y;i.\u5C3C\u6CCA\u5C14&&n(function(rt){var et=R()({},rt);return et.\u5C3C\u6CCA\u5C14={left:W,top:tt,visible:!0},et})})}),E.map(function(e){return v.addOverlay(e)}),function(){E.map(function(e){return v.removeOverlay(e)})}}}).catch(function(){var a=y.map(function(s){var E=s.name,e=s.lng,f=s.lat,h=new BMap.Point(e,f),B=new BMap.Marker(h);return r=r.concat([h]),B.addEventListener("click",function(){var d=v.pointToPixel(h),L=d.x,x=d.y;i[E]&&n(function(M){var C=R()({},M);return C[E]={left:L,top:x,visible:!0},C})}),B});return a.map(function(s){return v.addOverlay(s)}),function(){a.map(function(s){return v.removeOverlay(s)})}}),c.forEach(function(a,s){o.get(a,function(E){if(a){var e=E.boundaries.length;if(e!==0){for(var f=[],h=0;h<e;h++){var B=new BMap.Polygon(E.boundaries[h],{strokeWeight:2,strokeStyle:"dashed",strokeColor:"#0000ff",strokeOpacity:.6,fillColor:i[a]?"rgba(200,100,55,0.7)":"rgba(0,0,255,0.5)"});f=f.concat(B),r=r.concat(B.getPath()),B.addEventListener("click",function(d){var L=d==null?void 0:d.pixel,x=L.x,M=L.y;i[a]&&n(function(C){var W=R()({},C);return W[a]={left:x,top:M,visible:!0},W})})}return f.map(function(d){return v.addOverlay(d)}),s===c.length-1&&(I.current=function(){return v.setViewport(r)},A()),function(){f.map(function(d){return v.removeOverlay(d)})}}}})})}},[v]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{id:"map",ref:g}),(0,l.jsx)(F,{map:v,centerAndZoomMap:A}),Object.keys(u).map(function(o){var r=u[o],a=r.left,s=r.top,E=r.visible,e=i[o],f=e.title,h=e.time,B=e.name,d=$()(e,q);return(0,l.jsx)(J.Z,{title:"".concat(f," (").concat(h,")"),trigger:"click",rootClassName:"popover-container",open:E,content:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(Y.ZP,{className:"close-btn",shape:"circle",type:"link",danger:!0,icon:(0,l.jsx)(G.Z,{}),onClick:function(){n(function(x){var M=R()({},x);return M[o].visible=!1,M})}}),(0,l.jsx)(_,R()({},d))]}),children:(0,l.jsx)("div",{className:"content",style:{left:a,top:s}})},o)})]})}}}]);
