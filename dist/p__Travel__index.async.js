"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[63],{9700:function(tt,L,n){n.d(L,{MU:function(){return _},dd:function(){return Q}});var F=n(60522),z=n(64665),k=n(23435),S=n(167),$=n(63372),R=n(49956),y=n(78537),V=n(75171),G=n(84636),H=n(50838),J=n(69514),w=n(41151),T=n(28465),W=n(7162),Y=n(35183),N=n(53370),u=n(31648),X=n(6228),Z=n(67294);Y.D([z.N,k.N,S.N,$.N,R.N,y.N,V.N,G.N,H.N,J.N,w.N,X.N,T.N,W.N]);function Q(x){var U=(0,F.Z)(x);(0,Z.useEffect)(function(){var p;x.current&&((p=N.JE(x.current))===null||p===void 0||p.resize())},[U])}function _(x,U){(0,Z.useEffect)(function(){if(!x.current)return;var p=N.S1(x.current);p.setOption(U);function r(){p==null||p.resize()}return window.addEventListener("resize",r),function(){p.dispose(),window.removeEventListener("resize",r)}},[])}L.ZP=u},43614:function(tt,L,n){n.r(L),n.d(L,{default:function(){return x}});var F=n(13769),z=n.n(F),k=n(97857),S=n.n(k),$=n(5574),R=n.n($),y=n(67294),V=n(74627),G=n(75398),H=n(18429),J=n(64599),w=n.n(J),T=n(9700),W=n(55090),Y=n(11752),N=n(94272),u=n(85893),X=function(r){var h=(0,y.useMemo)(function(){return Object.keys(r).map(function(M){return{value:r[M],name:M}})},[r]),c=(0,y.useRef)(null),m={title:{left:"center",top:"center",text:`\u82B1\u8D39
`.concat(h.reduce(function(M,B){return M+(B==null?void 0:B.value)},0))},tooltip:{},legend:{left:"center",bottom:400},series:{type:"pie",radius:["35%","60%"],data:h,label:{show:!0,formatter:`{b}: {c}\u5143 

({d}%)`},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(200, 0, 0, 0.5)"}}}};return(0,T.dd)(c),(0,T.MU)(c,m),(0,u.jsx)("div",{className:"chart",ref:c})},Z=function(r){var h=r.map,c=r.centerAndZoomMap,m=(0,y.useState)(!1),M=R()(m,2),B=M[0],v=M[1];return(0,u.jsxs)("div",{className:"tools",children:[(0,u.jsx)(W.Z,{placement:"left",title:"\u5207\u6362\u5730\u56FE\u7C7B\u578B",children:(0,u.jsx)("div",{className:"tool mapType",onClick:function(){var E=(h==null?void 0:h.getMapType())===BMAP_NORMAL_MAP?BMAP_HYBRID_MAP:BMAP_NORMAL_MAP;h==null||h.setMapType(E)},children:"\u7C7B\u578B"})}),(0,u.jsx)(W.Z,{placement:"left",title:"\u82B1\u8D39\u7EDF\u8BA1",children:(0,u.jsx)("div",{className:"tool statistic",onClick:function(){c(0),v(!0)},children:"\u7EDF\u8BA1"})}),(0,u.jsx)(W.Z,{placement:"left",title:"\u8FD4\u56DE\u9ED8\u8BA4\u5730\u56FE",children:(0,u.jsx)("div",{onClick:function(){return c(0)},className:"tool reset",children:"\u8FD4\u56DE"})}),(0,u.jsx)(Q,{visible:B,setVisible:v})]})},Q=function(r){var h=r.visible,c=r.setVisible,m=(0,N.useModel)("@@initialState",function(l){var a=l.initialState;return a==null?void 0:a.travelData}),M=m.detailInfo,B=(0,y.useRef)(null),v=[],D=[],E=Object.values(JSON.parse(JSON.stringify(M))).reduce(function(l,a,C){var g=Object.keys(a).filter(function(o){return!["title","time"].includes(o)}),i=g.reduce(function(o,d){return o+=typeof a[d]=="number"&&d!=="\u603B\u989D"?a[d]:0},0);if(D.push([a.name,i]),C===0)l=g.map(function(o){return[o,a[o]]}),v=g;else{var e=g.filter(function(o){return!v.includes(o)});e.length&&(v=v.concat(e),e.forEach(function(o){l.push([o])}));var t=w()(g),s;try{var f=function(){var d=s.value;l.forEach(function(P){P[0]===d&&(P[C+1]=a[d])})};for(t.s();!(s=t.n()).done;)f()}catch(o){t.e(o)}finally{t.f()}}return l},[]),j={legend:{},tooltip:{trigger:"axis",confine:!0},dataset:{source:E},xAxis:{type:"category",axisLabel:{formatter:function(a){return a.split(" ").join(`

`)}}},title:{text:E[0][1].split(" ").join(`
`)+`

`+E.reduce(function(l,a){return l+=typeof a[1]=="number"?a[1]:0},0),left:"center",top:"18%"},yAxis:{gridIndex:0},grid:{top:"55%"},series:E.map(function(l,a){return a===E.length-1?{type:"pie",id:"pie",radius:["20%","30%"],center:["50%","25%"],emphasis:{focus:"self"},label:{formatter:"{b}: {@".concat(E[0][1],"} ({d}%)")},encode:{itemName:E[0][0],value:E[0][1],tooltip:E[0][1]}}:{type:"line",smooth:!0,seriesLayoutBy:"row",label:{show:!0,position:"top"},emphasis:{focus:"series"}}}).concat({type:"bar",name:"\u603B\u82B1\u8D39",data:D,barWidth:15,barGap:"20%"}),dataZoom:[{type:"inside",zoomOnMouseWheel:!0,moveOnMouseWheel:!0,moveOnMouseMove:!0}]};return(0,y.useEffect)(function(){if(!h)return;var l=T.ZP.init(B.current);l.on("updateAxisPointer",function(C){var g=C.axesInfo[0];if(g){var i=g.value+1;l.setOption({title:{text:E[0][i].split(" ").join(`
`)+`

`+E.reduce(function(e,t){return e+=typeof t[i]=="number"?t[i]:0},0),left:"center",top:"18%"},series:{id:"pie",label:{formatter:"{b}: {@["+i+"]} ({d}%)"},encode:{value:i,tooltip:i}}})}}),l.setOption(j);function a(){l==null||l.resize()}return window.addEventListener("resize",a),function(){l.dispose(),window.removeEventListener("resize",a)}},[h]),(0,u.jsx)(Y.Z,{width:800,title:"\u7EDF\u8BA1",open:h,footer:!1,onCancel:function(){return c(!1)},children:(0,u.jsx)("div",{ref:B,className:"statistic-modal"})})},_=["title","time","name"];function x(){var p=(0,N.useModel)("@@initialState",function(i){var e=i.initialState;return e==null?void 0:e.travelData}),r=p.detailInfo,h=p.traveled,c=p.traveledPoint,m=(0,y.useRef)(null),M=(0,y.useState)(),B=R()(M,2),v=B[0],D=B[1],E=(0,y.useState)({}),j=R()(E,2),l=j[0],a=j[1],C=(0,y.useRef)(),g=(0,y.useCallback)(function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:500;setTimeout(function(){var e;(e=C.current)===null||e===void 0||e.call(C),a({})},i)},[]);return(0,y.useEffect)(function(){if(m.current){var i=new BMap.Map(m.current),e=new BMap.Point(109,36);i.centerAndZoom(e,6),i.enableScrollWheelZoom(),i.setMapType(BMAP_HYBRID_MAP),D(i);var t=function(){a({})};return["zoomend","dragend"].forEach(function(s){return i.addEventListener(s,t)}),function(){["zoomend","dragend"].forEach(function(s){return i.removeEventListener(s,t)})}}},[]),(0,y.useEffect)(function(){if(v){var i=new BMap.Boundary,e=[];c.map(function(t){fetch("./geojson/".concat(t==null?void 0:t.name,".geojson")).then(function(s){return s==null?void 0:s.json()}).then(function(s){var f=U(s);return f.map(function(o){return e=e.concat(o.getPath()),o.addEventListener("click",function(d){var P=d==null?void 0:d.pixel,A=P.x,O=P.y;r[t==null?void 0:t.name]&&a(function(K){var I=S()({},K);return I[t==null?void 0:t.name]={left:A,top:O,visible:!0},I})}),v.addOverlay(o)}),console.log("==",f),function(){f==null||f.map(function(o){return v.removeOverlay(o)})}}).catch(function(){var s=new BMap.Point(t==null?void 0:t.lng,t==null?void 0:t.lat),f=new BMap.Marker(s);return e=e.concat([s]),f.addEventListener("click",function(){var o=v.pointToPixel(s),d=o.x,P=o.y;r[t==null?void 0:t.name]&&a(function(A){var O=S()({},A);return O[t==null?void 0:t.name]={left:d,top:P,visible:!0},O})}),v.addOverlay(f),function(){v.removeOverlay(f)}})}),h.forEach(function(t,s){i.get(t,function(f){if(t){var o=f.boundaries.length;if(o!==0){for(var d=[],P=0;P<o;P++){var A=new BMap.Polygon(f.boundaries[P],{strokeWeight:2,strokeStyle:"dashed",strokeColor:"#0000ff",strokeOpacity:.6,fillColor:r[t]?"rgba(200,100,55,0.7)":"rgba(0,0,255,0.5)"});d=d.concat(A),e=e.concat(A.getPath()),A.addEventListener("click",function(O){var K=O==null?void 0:O.pixel,I=K.x,b=K.y;r[t]&&a(function(et){var q=S()({},et);return q[t]={left:I,top:b,visible:!0},q})})}return d.map(function(O){return v.addOverlay(O)}),s===h.length-1&&(C.current=function(){return v.setViewport(e)},g()),function(){d.map(function(O){return v.removeOverlay(O)})}}}})})}},[v]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{id:"map",ref:m}),(0,u.jsx)(Z,{map:v,centerAndZoomMap:g}),Object.keys(l).map(function(i){var e=l[i],t=e.left,s=e.top,f=e.visible,o=r[i],d=o.title,P=o.time,A=o.name,O=z()(o,_);return(0,u.jsx)(V.Z,{title:"".concat(d," (").concat(P,")"),trigger:"click",rootClassName:"popover-container",open:f,content:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(G.ZP,{className:"close-btn",shape:"circle",type:"link",danger:!0,icon:(0,u.jsx)(H.Z,{}),onClick:function(){a(function(I){var b=S()({},I);return b[i].visible=!1,b})}}),(0,u.jsx)(X,S()({},O))]}),children:(0,u.jsx)("div",{className:"content",style:{left:t,top:s}})},i)})]})}function U(p){if(!p||!p.features)return console.error("\u65E0\u6548\u7684GeoJSON\u6570\u636E"),[];var r=[];return p.features.forEach(function(h){var c=h.geometry,m=[],M=c.type;if(M==="Point"){m=[c.coordinates[1],c.coordinates[0]];var B=new BMap.Point(m[0],m[1]),v=new BMap.Marker(B);r=r.concat(v)}else if(M==="LineString"){m=c.coordinates.map(function(e){return new BMap.Point(e[0],e[1])});var D=new BMap.Polyline(m,{strokeColor:"blue",strokeWeight:2,strokeOpacity:.5});r=r.concat(D)}else if(M==="Polygon"){m=c.coordinates[0].map(function(e){return new BMap.Point(e[0],e[1])});var E=new BMap.Polygon(m,{strokeColor:"transparent",strokeWeight:0,strokeOpacity:0,fillColor:"rgba(0, 0, 255, 0.1)",fillOpacity:.5});r=r.concat(E)}else if(M==="MultiPoint")m=c.coordinates.map(function(e){return new BMap.Point(e[0],e[1])}),m.forEach(function(e){var t=new BMap.Marker(e);r=r.concat(t)});else if(M==="MultiLineString")c.coordinates.forEach(function(e){var t=e.map(function(f){return new BMap.Point(f[0],f[1])}),s=new BMap.Polyline(t,{strokeColor:"blue",strokeWeight:2,strokeOpacity:.5});r=r.concat(s)});else if(M==="MultiPolygon"){var j=JSON.stringify(c.coordinates),l=j.match(/^\[*/),a=l?l[0].length:0;if(a===2){var C=c.coordinates.map(function(e){return new BMap.Point(e[0],e[1])}),g=new BMap.Polygon(C,{strokeWeight:2,strokeStyle:"dashed",strokeColor:"transparents",fillColor:"rgba(200,100,55,0.7)"});r=r.concat(g)}else if(a===4){var i=function(t){if(t.type!=="MultiPolygon"){console.error("\u4E0D\u662F MultiPolygon \u7C7B\u578B");return}var s=t.coordinates;s.forEach(function(f){f.forEach(function(o){var d=o.map(function(A){return new BMap.Point(A[0],A[1])}),P=new BMap.Polygon(d,{strokeWeight:2,strokeStyle:"dashed",strokeColor:"transparents",fillColor:"rgba(200,100,55,0.7)"});r=r.concat(P)})})};i(c)}}else console.warn("\u4E0D\u652F\u6301\u7684GeoJSON\u51E0\u4F55\u7C7B\u578B: "+M)}),r}}}]);
